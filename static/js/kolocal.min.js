var kolocal=angular.module("kolocal",["ngRoute","ui.bootstrap","ngSanitize","LocalStorageModule"]);kolocal.filter("groupFilter",function(){return function(a,b){var c="";if(a)for(var d=0;d<b.length;d++)if(a==b[d].id){c=b[d].name;break}return c}}),kolocal.filter("pay_type",function(){var a={cash:"现金",card:"刷卡",mypay:"会员卡",own:"签单",tenpay:"微信",tenpay_back:"微信退款",alipay:"支付宝",coupon:"优惠券",tenpay_coupon:"电子券",gift:"赠送",omit:"抹零",others:"其它"};return function(b){return b?a[b]:void 0}}),kolocal.filter("order_state",function(){var a={pre_tenpay:"微信待支付订单",todo:"客户自助下单",confirm:"已审核",cancel:"已取消"};return function(b){return b?a[b]:void 0}}),kolocal.filter("ko_pcategFilter",function(){return function(a,b){var c=[];if(a){if(b){c=[];for(var d=0;d<a.length;d++)a[d].categ_id&&b==a[d].categ_id&&c.push(a[d]);return c}return a}}}),kolocal.filter("order_type",function(){var a={"in":"堂食",out:"外卖",in_out:"外带",waste:"丢弃",myeat:"自用",renew:"补单"};return function(b){return b?a[b]:void 0}}),kolocal.filter("oneFilter",function(){return function(a,b){var c="";if(a&&b)for(var d=0;d<b.length;d++)if(b[d].id==a){c=b[d].name;break}return c}}),kolocal.directive("ngPrint",function(){function a(a,c,d){c.on("click",function(){var a=document.getElementById(d.printElementId);if(a){var c=a.cloneNode(!0);b.appendChild(c),window.print(),b.innerHTML=""}})}var b=document.getElementById("printSection");return b||(b=document.createElement("div"),b.id="printSection",document.body.appendChild(b)),{link:a,restrict:"A"}}),kolocal.directive("koKey",function(){return{scope:{inputData:"=koInput"},link:function(a,b,c){b.bind("click",function(){var b;b="0"==a.inputData||"00"==a.inputData?"":a.inputData;var d=c.koKey;if("-"==d)a.inputData="-"==b[0]?b.substring(1):"-"+b;else if("del"==d){var e=b.length;a.inputData=b.substring(0,e-1)}else"clr"==d||"do"==d||(a.inputData=b+d)})}}}),kolocal.config(["$httpProvider","$routeProvider",function(a,b){a.defaults.cache=!1,a.defaults.headers.get||(a.defaults.headers.get={}),a.defaults.headers.get["If-Modified-Since"]="0",b.when("/",{controller:"BaseCtrl",templateUrl:"../static/templates/base.html"}),b.when("/printer",{controller:"PrinterCtrl",templateUrl:"../static/templates/printer.html"}),b.when("/data",{controller:"DataCtrl",templateUrl:"../static/templates/data.html"}),b.when("/offline/pos",{controller:"ServiceSessionCtrl",templateUrl:"/static/templates/offline_pos_session.html"}),b.when("/offline/pos/:posId",{controller:"ServicePosCtrl",templateUrl:"/static/templates/offline_pos_order.html"}),b.otherwise({redirectTo:"/"})}]),kolocal.controller("BaseCtrl",["$scope","$window","$location","$http",function(a,b,c){"use strict";a.actionPrinter=function(){c.path("/printer")},a.actionOffline=function(){b.location="http://127.0.0.1:34301/offline/main"},a.actionOnline=function(){b.location="/exchange"}}]),kolocal.controller("PrinterCtrl",["$scope","$window","$location","$http",function(a,b,c,d){"use strict";a.actionClose=function(){c.path("/")},a.err="",a.closeError=function(){a.err=""},a.actionClose=function(){c.path("/")},a.avail_printer_types=[{name:"本地打印机",value:"driver"}],a.avail_place=[1,2,3,4,5,6,7,8,9],d.get("/conf/get").success(function(b){b.error?a.$parent.err=b.error:(a.receiptPrinter=b.value.receipt,a.cookiePrinters=b.value.cookie||[],a.donePrinters=b.value.done||[],a.tablePrinters=b.value.table||[],a.download=b.value.download,a.returned_notify=b.value.returned_notify,a.company_id=b.value.company_id,a.server_key=b.value.server_key)}).error(function(){a.$parent.err="网络错误"}),d.get("/conf/localprinter").success(function(b){b.error?a.$parent.err=b.error:a.localprinters=b.value}).error(function(){a.$parent.err="网络错误"}),a.addCookiePrinter=function(){a.cookiePrinters.push({width:0,name:"",type:"driver",ip:"",out:0})},a.removeCookiePrinter=function(b){for(var c=[],d=0;d<a.cookiePrinters.length;d++)d!=b&&c.push(a.cookiePrinters[d]);a.cookiePrinters=c},a.addDonePrinter=function(){a.donePrinters.push({width:0,name:"",type:"driver",ip:"",out:0})},a.removeDonePrinter=function(b){for(var c=[],d=0;d<a.donePrinters.length;d++)d!=b&&c.push(a.donePrinters[d]);a.donePrinters=c},a.addTablePrinter=function(){a.tablePrinters.push({width:0,name:"",type:"driver",ip:"",out:0})},a.removeTablePrinter=function(b){for(var c=[],d=0;d<a.tablePrinters.length;d++)d!=b&&c.push(a.tablePrinters[d]);a.tablePrinters=c},a.actionSave=function(){if(a.direct||a.receiptPrinter.type||a.receiptPrinter.width||!a.receiptPrinter.place||(a.err="请将小票/交班打印机内容填写完整!"),a.cookiePrinters.length>0)for(var b=0;b<a.cookiePrinters.length;b++)if(!a.cookiePrinters[b].type&&!a.cookiePrinters[b].width&&a.cookiePrinters[b].place)return void(a.err="请将出品打印机内容填写完整!");var c={receipt:a.receiptPrinter,table:a.tablePrinters,cookie:a.cookiePrinters,done:a.donePrinters,download:a.download,company_id:a.company_id,server_key:a.server_key,returned_notify:a.returned_notify};d.post("/conf/save",c).success(function(a){alert(a.error?a.error:"保存成功,请重启系统")}).error(function(){a.$parent.err="网络错误"})}}]);
//# sourceMappingURL=kolocal.min.js.map